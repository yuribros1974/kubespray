FROM centos:7.6.1810

ENV MITOGEN_POOL_SIZE=50
ENV ANSIBLE_STRATEGY=mitogen_linear

RUN mkdir /kubespray

WORKDIR /kubespray

RUN yum install -y epel-release \
    && yum install -y openssl-devel openssh-clients python-devel sshpass gcc ca-certificates curl gnupg2 python2-pip python36 python36-pip \
    && yum clean all \
    && rm -rf /var/cache/yum \
    && pip install --no-cache-dir --upgrade pip==20.1.1

COPY igz_requirements.txt ./igz_requirements.txt
RUN /usr/bin/pip install -r igz_requirements.txt

COPY contrib/inventory_builder/requirements.txt ./requirements.txt
RUN /usr/bin/pip3 install -r requirements.txt

COPY . .

ENTRYPOINT ["/kubespray/run.py"]
